{{ define "main" }}
  <section id="detail-view" class="view is-active" aria-label="Spacegroup detail view">
    <div class="detail-header panel">
      <div class="detail-meta">
        <div class="detail-meta-item">
          <p class="kicker">Hall</p>
          <select class="detail-select" aria-label="Select Hall symbol" onchange="if (this.value) window.location = this.value;">
            {{ range .Site.Data.spacegroup_lists.halls }}
              {{ $url := printf "hall/%s/" . | relURL }}
              <option value="{{ $url }}" {{ if eq $.Params.hall_key . }}selected{{ end }}>{{ . }}</option>
            {{ end }}
          </select>
        </div>
        <div class="detail-meta-item">
          <p class="kicker">HM</p>
          <select class="detail-select" aria-label="Select HM symbol" onchange="if (this.value) window.location = this.value;">
            {{ range .Site.Data.spacegroup_lists.hm_values }}
              {{ $hall := index $.Site.Data.spacegroup_lists.hm_to_hall . }}
              {{ $url := printf "hall/%s/" $hall | relURL }}
              <option value="{{ $url }}" {{ if eq $.Params.universal_hm . }}selected{{ end }}>{{ . }}</option>
            {{ end }}
          </select>
        </div>
        <div class="detail-meta-item">
          <p class="kicker">ITA#</p>
          <select class="detail-select" aria-label="Select ITA number" onchange="if (this.value) window.location = this.value;">
            {{ range .Site.Data.spacegroup_lists.ita_values }}
              {{ $key := printf "%v" . }}
              {{ $hall := index $.Site.Data.spacegroup_lists.ita_to_hall $key }}
              {{ $url := printf "hall/%s/" $hall | relURL }}
              <option value="{{ $url }}" {{ if eq (printf "%v" $.Params.ita_number) $key }}selected{{ end }}>#{{ . }}</option>
            {{ end }}
          </select>
        </div>
      </div>
    </div>

    <div class="detail-grid">
      <article class="detail-card panel section-wide">
        <h3>Alternative settings</h3>
        {{ $related := .Params.related_settings }}
        {{ if $related }}
          <div class="related-links">
            {{ range $related }}
              {{ $classes := slice "related-link" }}
              {{ if .is_reference_setting }}{{ $classes = $classes | append "is-standard" }}{{ end }}
              {{ if eq $.Params.hall_key .hall_key }}{{ $classes = $classes | append "is-active" }}{{ end }}
              {{ $label := default .hall_key (index $.Site.Data.spacegroup_lists.hall_latex .hall_key) }}
              <a class="{{ delimit $classes " " }}" href="{{ printf "hall/%s/" .hall_key | relURL }}">
                <span class="math-content">{{ $label }}</span>
              </a>
            {{ end }}
          </div>
          <p class="note">Bold border: ITA reference setting.</p>
        {{ else }}
          <p class="note">No related Hall settings available.</p>
        {{ end }}
      </article>

      <article class="detail-card panel section-half">
        <h3>Identity</h3>
        <div class="identity-grid">
          <div class="metric">
            <label>Hall Symbol</label>
            {{ $hallSymbol := default .Params.hall_key .Params.hall_latex }}
            <strong><span class="math-content">{{ partial "value.html" $hallSymbol }}</span></strong>
          </div>
          <div class="metric">
            <label>Short HM <span tabindex="0" class="info-dot" data-tip="Short Hermann-Mauguin symbol, a compact notation for symmetry elements.">i</span></label>
            {{ $shortHM := default .Params.short_hm_symbol .Params.short_hm_symbol_latex }}
            <strong><span class="math-content">{{ partial "value.html" $shortHM }}</span></strong>
          </div>
          <div class="metric">
            <label>Universal HM</label>
            {{ $universalHM := default .Params.universal_hm .Params.universal_hm_latex }}
            <strong><span class="math-content">{{ partial "value.html" $universalHM }}</span></strong>
          </div>
          <div class="metric">
            <label>n:c <span tabindex="0" class="info-dot" data-tip="Conventional setting label used in the source dataset.">i</span></label>
            <strong>{{ partial "value.html" .Params.n_c }}</strong>
          </div>
          <div class="metric">
            <label>Point Group <span tabindex="0" class="info-dot" data-tip="Point group describing rotational/reflection symmetry without translations.">i</span></label>
            <strong>{{ partial "value.html" .Params.point_group }}</strong>
          </div>
          <div class="metric">
            <label>Laue Class <span tabindex="0" class="info-dot" data-tip="Laue class used in diffraction symmetry classification.">i</span></label>
            <strong>{{ partial "value.html" .Params.laue_class }}</strong>
          </div>
          <div class="metric">
            <label>Crystal System <span tabindex="0" class="info-dot" data-tip="Crystal family grouping by lattice constraints and symmetry type.">i</span></label>
            <strong>{{ partial "value.html" .Params.crystal_system }}</strong>
          </div>
        </div>
      </article>

      <article class="detail-card panel section-half">
        <h3>Details</h3>
        <div class="flag-row">
          {{ $flags := slice "is_centric" "is_chiral" "is_enantiomorphic" "is_reference_setting" }}
          {{ range $flags }}
            {{ $value := index $.Params . }}
            <span class="flag-pill {{ if $value }}true{{ else }}false{{ end }}">{{ replace . "_" " " }}: {{ if $value }}yes{{ else }}no{{ end }}</span>
          {{ end }}
        </div>
        <p class="note">Schoenflies: {{ partial "value.html" .Params.schoenflies }}</p>
        <p class="note">Qualifier: {{ partial "value.html" .Params.qualifier }}</p>
        <p class="note">Asymmetric unit <span tabindex="0" class="info-dot" data-tip="Asymmetric unit bounds that generate the full unit cell under symmetry operations.">i</span>: {{ partial "value.html" .Params.asym_unit }}</p>
        <p class="note">Lattice translations: {{ partial "value.html" .Params.n_ltr }}</p>
        <p class="note">Symmetry operations count: {{ partial "value.html" .Params.n_smx }}</p>
        <p class="note">Order Z: {{ partial "value.html" .Params.order_z }}</p>
      </article>

      <article class="detail-card panel section-wide">
        <h3>Symmetry Operations <span tabindex="0" class="info-dot" data-tip="Symmetry operations represented in coordinate form x,y,z with optional origin shifts.">i</span></h3>
        {{ $symops := .Params.symops }}
        {{ if $symops }}
          <table class="data-table">
            <thead>
              <tr>
                <th>#</th>
                <th>xyz</th>
                <th>rot_type</th>
                <th>screw/glide</th>
              </tr>
            </thead>
            <tbody>
              {{ range $index, $op := $symops }}
                <tr>
                  <td>{{ add $index 1 }}</td>
                  <td>{{ partial "value.html" $op.xyz }}</td>
                  <td>{{ partial "value.html" $op.rot_type }}</td>
                  <td>{{ partial "value.html" $op.screw_glide }}</td>
                </tr>
              {{ end }}
            </tbody>
          </table>
          <p class="note">Showing all {{ len $symops }} operations.</p>
        {{ else }}
          <p class="note">No symmetry operations in this entry.</p>
        {{ end }}
      </article>

      <article class="detail-card panel section-wide">
        <h3>Wyckoff Positions <span tabindex="0" class="info-dot" data-tip="Wyckoff positions grouped by multiplicity and site symmetry.">i</span></h3>
        {{ $wyckoff := .Params.wyckoff }}
        {{ if $wyckoff }}
          {{ $labels := slice }}
          {{ range $label, $_ := $wyckoff }}
            {{ $labels = $labels | append $label }}
          {{ end }}
          {{ $labels = sort $labels }}
          {{ if gt (len $labels) 0 }}
            <table class="data-table">
              <thead>
                <tr>
                  <th>Label</th>
                  <th>Multiplicity</th>
                  <th>Site Symmetry</th>
                  <th>Full Orbit (xyz)</th>
                </tr>
              </thead>
              <tbody>
                {{ range $labels }}
                  {{ $item := index $wyckoff . }}
                  {{ $orbit := $item.orbit_xyz }}
                  {{ $orbitText := partial "orbit.html" $orbit }}
                  <tr>
                    <td>{{ . }}</td>
                    <td>{{ partial "value.html" $item.multiplicity }}</td>
                    <td>{{ partial "value.html" $item.sitesym }}</td>
                    <td class="orbit-cell">{{ $orbitText }}</td>
                  </tr>
                {{ end }}
              </tbody>
            </table>
            <p class="note">{{ len $labels }} Wyckoff position{{ if ne (len $labels) 1 }}s{{ end }} listed.</p>
          {{ else }}
            <p class="note">No Wyckoff labels present.</p>
          {{ end }}
        {{ else }}
          <p class="note">No Wyckoff data available.</p>
        {{ end }}
      </article>
    </div>
  </section>
{{ end }}
